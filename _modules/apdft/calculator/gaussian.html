

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>apdft.calculator.gaussian &mdash; APDFT  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> APDFT
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">APDFT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features and supported software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html#adding-support-for-additional-software-packages">Adding support for additional software packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apdft.html">Implementation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">APDFT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../apdft.html">apdft</a> &raquo;</li>
        
          <li><a href="../calculator.html">apdft.calculator</a> &raquo;</li>
        
      <li>apdft.calculator.gaussian</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for apdft.calculator.gaussian</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">apdft</span> <span class="k">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">apdft</span> <span class="k">import</span> <span class="n">calculator</span>
<span class="kn">import</span> <span class="nn">apdft.physics</span> <span class="k">as</span> <span class="nn">ap</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">basis_set_exchange</span> <span class="k">as</span> <span class="nn">bse</span>
<span class="kn">import</span> <span class="nn">jinja2</span> <span class="k">as</span> <span class="nn">j</span>


<div class="viewcode-block" id="GaussianCalculator"><a class="viewcode-back" href="../../../apdft.html#apdft.calculator.gaussian.GaussianCalculator">[docs]</a><span class="k">class</span> <span class="nc">GaussianCalculator</span><span class="p">(</span><span class="n">calculator</span><span class="o">.</span><span class="n">Calculator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Performs the QM calculations for APDFT with the help of Gaussian.</span>

<span class="sd">    General Idea:</span>
<span class="sd">    Gaussian supports both fractional nuclar charges (via the undocumented `Massage` keyword) and the evaluation of the electrostatic potential at the nucleus (via the `Prop` keyword). Earlier versions used to read fchk files and map out a grid, which is less accurate, but also feasible in Gaussian.&quot;&quot;&quot;</span>

    <span class="n">_methods</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;CCSD&quot;</span><span class="p">:</span> <span class="s2">&quot;CCSD(Full,MaxCyc=100)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PBE0&quot;</span><span class="p">:</span> <span class="s2">&quot;PBE1PBE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PBE&quot;</span><span class="p">:</span> <span class="s2">&quot;PBEPBE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;HF&quot;</span><span class="p">:</span> <span class="s2">&quot;UHF&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_format_coordinates</span><span class="p">(</span><span class="n">nuclear_numbers</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">Z</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">nuclear_numbers</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ret</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_format_basisset</span><span class="p">(</span><span class="n">nuclear_charges</span><span class="p">,</span> <span class="n">basisset</span><span class="p">,</span> <span class="n">superimposed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">atomid</span><span class="p">,</span> <span class="n">nuclear_charge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nuclear_charges</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">superimposed</span><span class="p">:</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="n">nuclear_charge</span><span class="p">)))</span>
                        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">,</span>
                            <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                            <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="p">)</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="n">nuclear_charge</span><span class="p">)))</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">,)])</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">bse</span><span class="o">.</span><span class="n">get_basis</span><span class="p">(</span><span class="n">basisset</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">elements</span><span class="p">),</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;gaussian94&quot;</span><span class="p">)</span>

            <span class="n">res</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> 0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atomid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">skipnext</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">):</span>
                    <span class="n">skipnext</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;****&quot;</span><span class="p">:</span>
                    <span class="n">skipnext</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">skipnext</span><span class="p">:</span>
                    <span class="n">skipnext</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">continue</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">res</span> <span class="o">+=</span> <span class="s2">&quot;****</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_format_nuclear</span><span class="p">(</span><span class="n">nuclear_charges</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> Nuc </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nuclear_charges</span><span class="p">)]</span>
        <span class="p">)</span>

<div class="viewcode-block" id="GaussianCalculator.get_input"><a class="viewcode-back" href="../../../apdft.html#apdft.calculator.gaussian.GaussianCalculator.get_input">[docs]</a>    <span class="k">def</span> <span class="nf">get_input</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">nuclear_numbers</span><span class="p">,</span> <span class="n">nuclear_charges</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">iscomparison</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="n">basedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/templates/gaussian.txt&quot;</span> <span class="o">%</span> <span class="n">basedir</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

        <span class="n">env_coord</span> <span class="o">=</span> <span class="n">GaussianCalculator</span><span class="o">.</span><span class="n">_format_coordinates</span><span class="p">(</span><span class="n">nuclear_numbers</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">)</span>
        <span class="n">env_basis</span> <span class="o">=</span> <span class="n">GaussianCalculator</span><span class="o">.</span><span class="n">_format_basisset</span><span class="p">(</span>
            <span class="n">nuclear_charges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_basisset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_superimpose</span>
        <span class="p">)</span>
        <span class="n">env_nuc</span> <span class="o">=</span> <span class="n">GaussianCalculator</span><span class="o">.</span><span class="n">_format_nuclear</span><span class="p">(</span><span class="n">nuclear_charges</span><span class="p">)</span>
        <span class="n">env_molcharge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nuclear_charges</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nuclear_numbers</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
            <span class="n">coordinates</span><span class="o">=</span><span class="n">env_coord</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_methods</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_method</span><span class="p">],</span>
            <span class="n">basisset</span><span class="o">=</span><span class="n">env_basis</span><span class="p">,</span>
            <span class="n">nuclearcharges</span><span class="o">=</span><span class="n">env_nuc</span><span class="p">,</span>
            <span class="n">moleculecharge</span><span class="o">=</span><span class="n">env_molcharge</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="GaussianCalculator.get_runfile"><a class="viewcode-back" href="../../../apdft.html#apdft.calculator.gaussian.GaussianCalculator.get_runfile">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_runfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">nuclear_numbers</span><span class="p">,</span> <span class="n">nuclear_charges</span><span class="p">,</span> <span class="n">grid</span><span class="p">):</span>
        <span class="n">basedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/templates/gaussian-run.sh&quot;</span> <span class="o">%</span> <span class="n">basedir</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="n">fh</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">()</span></div>

<div class="viewcode-block" id="GaussianCalculator.get_total_energy"><a class="viewcode-back" href="../../../apdft.html#apdft.calculator.gaussian.GaussianCalculator.get_total_energy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_total_energy</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the total energy in Hartree.&quot;&quot;&quot;</span>
        <span class="n">chkfile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/run.fchk&quot;</span> <span class="o">%</span> <span class="n">folder</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">chkfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">scflines</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="n">_</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scflines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">scflines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">energy</span></div>

<div class="viewcode-block" id="GaussianCalculator.get_epn"><a class="viewcode-back" href="../../../apdft.html#apdft.calculator.gaussian.GaussianCalculator.get_epn">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_epn</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">,</span> <span class="n">includeatoms</span><span class="p">,</span> <span class="n">nuclear_charges</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extracts the EPN from a Gaussian log file. </span>

<span class="sd">        The Gaussian convention is to include the nuclear interaction of all other sites. Signs are in the physical sense, i.e. the electronic contribution is negative, while the nuclear contribution is positive. This function also converts to the APDFT convention where :math:`\int \rho / |\mathbf{r}-\mathbf{R}_I` is positive. </span>
<span class="sd">            </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            folder: String, the path to the calculation.</span>
<span class="sd">            coordiantes: Nuclear coordinates</span>
<span class="sd">            includeatoms: List of zero-based indices of the atoms to include in APDFT</span>
<span class="sd">            nuclear_charges: Float, list of nuclear charges for this particular calculation.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/run.log&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

        <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
                <span class="s2">&quot;    Center     Electric         -------- Electric Field --------</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="o">+</span> <span class="mi">3</span>
        <span class="p">)</span>
        <span class="n">epns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">atomidx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="n">offset</span> <span class="p">:</span> <span class="n">offset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)]):</span>
            <span class="k">if</span> <span class="n">atomidx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">includeatoms</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">epn</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">epn</span> <span class="o">-=</span> <span class="n">ap</span><span class="o">.</span><span class="n">Coulomb</span><span class="o">.</span><span class="n">nuclear_potential</span><span class="p">(</span><span class="n">coordinates</span><span class="p">,</span> <span class="n">nuclear_charges</span><span class="p">,</span> <span class="n">atomidx</span><span class="p">)</span>
            <span class="n">epns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">epn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">epns</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Guido Falk von Rudorff

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>